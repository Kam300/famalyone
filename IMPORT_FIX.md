# Исправление импорта/экспорта данных

## Проблемы, которые были исправлены:

### 1. Диалог открывался несколько раз
**Причина:** Использование `observe()` внутри `lifecycleScope` вызывало повторные срабатывания при каждом изменении данных.

**Решение:** Заменил `observe()` на синхронный метод `getAllMembersSync()`.

### 2. Связи родителей не импортировались
**Причина:** ID из JSON файла не совпадали с новыми ID в базе данных после вставки.

**Решение:** 
- Импорт теперь происходит в 2 этапа:
  1. Добавляем всех членов БЕЗ связей и сохраняем маппинг старых ID → новые ID
  2. Обновляем связи родителей, используя новые ID из маппинга

### 3. Добавлено логирование и отчёты
**Что добавлено:**
- Логирование в Logcat для отладки (тег "Import")
- Предупреждения о несуществующих родителях
- Детальный отчёт о восстановленных связях

## Что изменилось:

### SettingsActivity.kt
- `importData()`: Убрал `observe()`, добавил двухэтапный импорт с маппингом ID
- `exportData()`: Убрал `observe()`, использую синхронный метод

### FamilyViewModel.kt
Добавлены синхронные методы:
- `getAllMembersSync()` - получить всех членов
- `insertMemberSync()` - вставить члена и вернуть новый ID
- `updateMemberParents()` - обновить связи родителей

### DataImportExport.kt
- `parseJsonToMembers()`: Теперь сохраняет оригинальный ID из JSON для маппинга

## Как это работает:

1. **Экспорт:**
   - Получаем всех членов семьи
   - Сохраняем в JSON с их текущими ID и связями
   - Показываем диалог ОДИН РАЗ

2. **Импорт:**
   - Читаем JSON с оригинальными ID
   - Добавляем членов БЕЗ связей, получаем новые ID
   - Создаём маппинг: старый ID → новый ID
   - Обновляем связи родителей, используя новые ID
   - Показываем диалог ОДИН РАЗ

## Результат:
✅ Диалог открывается только один раз
✅ Все связи родителей корректно импортируются (если родители есть в JSON)
✅ Дубликаты правильно определяются и пропускаются
✅ Логирование показывает, какие связи не восстановлены
✅ Диалог показывает статистику восстановленных связей

## Важно:
⚠️ Если в JSON есть ссылки на родителей (fatherId/motherId), которых нет в файле, эти связи не будут восстановлены. Приложение покажет предупреждение в диалоге и логах.
